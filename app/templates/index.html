{% extends "base.html" %}
{% block content %}
<h2>Project overview</h2>

<form class="filters" method="get">
  <input type="text" name="q" placeholder="Search..." value="{{ q }}">
  <select name="category">
    <option value="">All categories</option>
    {% for c in categories %}
      <option value="{{c}}" {% if category==c %}selected{% endif %}>{{c}}</option>
    {% endfor %}
  </select>
  <select name="sort">
    <option value="newest" {% if sort=='newest' %}selected{% endif %}>Newest</option>
    <option value="ending" {% if sort=='ending' %}selected{% endif %}>Almost expire</option>
    <option value="mostfunded" {% if sort=='mostfunded' %}selected{% endif %}>Most funded</option>
  </select>
  <button type="submit">Apply</button>
</form>

<div class="grid">
  {% for p in projects %}
  <a class="card" href="{{ url_for('proj.project_detail', pid=p.project_id) }}">
    <h3>{{ p.name }}</h3>
    <div class="muted">{{ p.category }} • ID {{ p.project_id }}</div>
    <div class="bar"><span style="width: {{ p.progress_pct() }}%"></span></div>
    <div class="muted">฿{{ p.current_amount }} / ฿{{ p.goal }} • deadline {{ p.deadline }}</div>
    {% if p.is_success() %}<div class="badge ok">Success</div>{% elif p.is_failed() %}<div class="badge fail">Failed</div>{% endif %}
  </a>
  {% endfor %}
</div>
{% endblock %}
